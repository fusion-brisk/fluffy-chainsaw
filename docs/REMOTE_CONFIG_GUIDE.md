# Remote Config –¥–ª—è –ø—Ä–∞–≤–∏–ª –ø–∞—Ä—Å–∏–Ω–≥–∞

## üìã –û–±–∑–æ—Ä

–ü–ª–∞–≥–∏–Ω **EProductSnippet** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø–∞—Ä—Å–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ —É–¥–∞–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (Remote Config), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–µ–∑ –ø–µ—Ä–µ–≤—ã–ø—É—Å–∫–∞ –ø–ª–∞–≥–∏–Ω–∞.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª:
1. **Remote** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
2. **Cached** (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ `clientStorage`)
3. **Embedded** (–≤—à–∏—Ç—ã–µ `DEFAULT_PARSING_RULES` –∫–∞–∫ fallback)

### –ú—è–≥–∫–∏–π merge (Soft Merge)
–£–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ **–¥–æ–ø–æ–ª–Ω—è—é—Ç**, –∞ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç –±–∞–∑–æ–≤—ã–µ:
- –ï—Å–ª–∏ –ø–æ–ª–µ –µ—Å—Ç—å –≤ remote ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è remote –≤–µ—Ä—Å–∏—è
- –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ—Ç –≤ remote ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è embedded –≤–µ—Ä—Å–∏—è
- –ù–æ–≤—ã–µ –ø–æ–ª—è –∏–∑ remote –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ URL –¥–ª—è remote config

```typescript
// –í clientStorage —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
contentify_remote_config_url = 'https://raw.githubusercontent.com/username/repo/main/parsing-rules.json'
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø–ª–∞–≥–∏–Ω–∞:
1. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ –∫—ç—à–∞ (–∏–ª–∏ embedded fallback)
2. –í —Ñ–æ–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ URL
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è hash —Ç–µ–∫—É—â–∏—Ö –∏ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
4. –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### 3. –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```
üåê Parsing Rules Update Available

A new version of parsing rules is available. Would you like to update?

Current: v1  ‚Üí  New: v2

[Not Now]  [Update]
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- **Update** ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à)
- **Not Now** ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∂–µ –≤—Ä—É—á–Ω—É—é)

### 4. –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–í UI –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ **üîÑ** –≤ —Å–µ–∫—Ü–∏–∏ "Parsing Rules":
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω—ã

### 5. –°–±—Ä–æ—Å –∫ defaults

–ö–Ω–æ–ø–∫–∞ **üóëÔ∏è** (–¥–æ—Å—Ç—É–ø–Ω–∞, –µ—Å–ª–∏ source != 'embedded'):
- –û—á–∏—â–∞–µ—Ç –∫—ç—à
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–∞–≥–∏–Ω –∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º

## üìÑ –§–æ—Ä–º–∞—Ç remote config

### –ü—Ä–∏–º–µ—Ä JSON-—Ñ–∞–π–ª–∞:

```json
{
  "version": 2,
  "rules": {
    "#OrganicTitle": {
      "domSelectors": [
        ".OrganicTitle",
        "[class*='OrganicTitle']",
        ".NewClass-Title"
      ],
      "jsonKeys": ["title", "name", "headline"],
      "type": "text"
    },
    "#ShopName": {
      "domSelectors": [".EShopName", "[class*='EShopName']"],
      "jsonKeys": ["shopName", "shop"],
      "type": "text"
    },
    "#NewField": {
      "domSelectors": [".NewSelector"],
      "jsonKeys": ["newKey"],
      "type": "text"
    }
  }
}
```

### –°—Ö–µ–º–∞:

```typescript
interface ParsingSchema {
  version: number;
  rules: Record<string, FieldRule>;
}

interface FieldRule {
  domSelectors: string[];
  jsonKeys: string[];
  type?: 'text' | 'image' | 'price' | 'html' | 'attribute' | 'boolean';
  domAttribute?: string;
}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ clientStorage

```typescript
contentify_parsing_rules_cache ‚Üí JSON –ø—Ä–∞–≤–∏–ª (ParsingSchema)
contentify_parsing_rules_metadata ‚Üí { lastUpdated, hash, remoteUrl }
contentify_remote_config_url ‚Üí URL –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
contentify_pending_rules ‚Üí –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

### Hash-–ø—Ä–æ–≤–µ—Ä–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π hash –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π:

```typescript
function simpleHash(str: string): string {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return String(hash);
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

Remote config –¥–æ–ª–∂–µ–Ω:
- –ë—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º JSON
- –°–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–µ `version` (number)
- –°–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–µ `rules` (Record<string, FieldRule>)

–ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–ª–∏ fetch ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–∫—ç—à/embedded).

## üìä UI –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### –í ParsingRulesViewer –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

- **Source**: üåê Remote / üíæ Cached / üì¶ Embedded
- **Updated**: –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **URL**: —Å—Å—ã–ª–∫–∞ –Ω–∞ remote config (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)

### –õ–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏—è:

```
üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª —Å https://...
‚ú® –ù–∞–π–¥–µ–Ω—ã –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
‚úÖ –£–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
üîÑ –°–±—Ä–æ—Å –ø—Ä–∞–≤–∏–ª –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã**: –≤—Å–µ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
2. **Hash-–ø—Ä–æ–≤–µ—Ä–∫–∞**: –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª —Å–≤–µ—Ä—è–µ—Ç—Å—è hash –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–º–µ–Ω—ã
3. **–ú—è–≥–∫–∏–π merge**: –µ—Å–ª–∏ —á–∞—Å—Ç—å –ø—Ä–∞–≤–∏–ª –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è embedded fallback
4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è

## üåê Hosting –Ω–∞ GitHub

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```
contentify-config/
‚îú‚îÄ‚îÄ parsing-rules.json     ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îú‚îÄ‚îÄ parsing-rules-v2.json  ‚Üê –í–µ—Ä—Å–∏–∏ –¥–ª—è rollback
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ CHANGELOG.md
```

### –ü—Ä–∏–º–µ—Ä URL:

```
https://raw.githubusercontent.com/username/contentify-config/main/parsing-rules.json
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ GitHub:
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Git history)
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ raw.githubusercontent.com
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å rollback –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º
- ‚úÖ Issues/PR –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üõ†Ô∏è API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### ParsingRulesManager

```typescript
class ParsingRulesManager {
  loadRules(): Promise<ParsingRulesMetadata>
  checkForUpdates(): Promise<{ hasUpdate: boolean; newRules?: ParsingSchema; hash?: string } | null>
  applyRemoteRules(hash: string): Promise<boolean>
  dismissUpdate(): Promise<void>
  resetToDefaults(): Promise<ParsingRulesMetadata>
  setRemoteUrl(url: string): Promise<void>
  getRemoteUrl(): Promise<string | null>
  getCurrentMetadata(): ParsingRulesMetadata | null
  getCurrentRules(): ParsingSchema
}
```

### –°–æ–æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É UI ‚Üî Code

#### UI ‚Üí Code:
- `get-parsing-rules` ‚Äî –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤–∏–ª
- `check-remote-rules-update` ‚Äî —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- `apply-remote-rules` ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- `dismiss-rules-update` ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `reset-rules-cache` ‚Äî —Å–±—Ä–æ—Å –∫ defaults

#### Code ‚Üí UI:
- `parsing-rules-loaded` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (—Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏)
- `rules-update-available` ‚Äî –¥–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –≤–µ—Ä—Å–∏—è–º–∏ –∏ hash)

## üìù TODO (–±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)

- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ URL —á–µ—Ä–µ–∑ UI (input –≤ Settings)
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–æ–≤)
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä changelog –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- [ ] –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≤ UI
- [ ] Export/Import –ø—Ä–∞–≤–∏–ª –≤ JSON
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

## üêõ Troubleshooting

### –ü—Ä–∞–≤–∏–ª–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ clientStorage
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL (CORS, —Ñ–æ—Ä–º–∞—Ç)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ fetch

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
1. –ù–∞–∂–º–∏—Ç–µ üóëÔ∏è –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫ defaults
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç remote config (–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

### –î–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ hash —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ remote config –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

