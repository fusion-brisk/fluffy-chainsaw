# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≠—Ç–∞–ø 1: Quick Wins

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–æ—Å–ª–µ –∫–æ–¥-—Ä–µ–≤—å—é –ø–æ –ø—Ä–æ–º–ø—Ç—É `Performance_Optimization_Code_Review` –≤—ã—è–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API.

## –¶–µ–ª–∏ —ç—Ç–∞–ø–∞

1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É –∫—ç—à–∞ –≤ `component-cache.ts`
2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫—ç—à–∞ (—É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
3. –î–æ–±–∞–≤–∏—Ç—å JSDoc –∏ `@deprecated` –∫ —Å—Ç–∞—Ä—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
4. –£–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –≤ handlers

## –ó–∞–¥–∞—á–∞ 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `resetComponentCache()`

### –§–∞–π–ª: `src/utils/component-cache.ts`

### –¢–µ–∫—É—â–∏–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 278-298):
```typescript
export function resetComponentCache(): void {
  // –û—á–∏—â–∞–µ–º –∫—ç—à instanceId ‚Üí componentId
  for (const key in instanceToComponentCache) {
    if (Object.prototype.hasOwnProperty.call(instanceToComponentCache, key)) {
      delete instanceToComponentCache[key];
    }
  }
  
  // –û—á–∏—â–∞–µ–º –∫—ç—à componentId ‚Üí PropertyInfo
  for (const key in componentPropertiesCache) {
    if (Object.prototype.hasOwnProperty.call(componentPropertiesCache, key)) {
      delete componentPropertiesCache[key];
    }
  }
  // ...
}
```

### –ü—Ä–æ–±–ª–µ–º–∞:
`for...in` + `delete` ‚Äî O(n) –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π V8 hidden classes.

### –†–µ—à–µ–Ω–∏–µ:

1. –ò–∑–º–µ–Ω–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–π —Å `const` –Ω–∞ `let` (—Å—Ç—Ä–æ–∫–∏ 33-36):

```typescript
// –ë—ã–ª–æ:
const instanceToComponentCache: { [instanceId: string]: string } = {};
const componentPropertiesCache: { [componentId: string]: ComponentPropertyInfo } = {};

// –°—Ç–∞–ª–æ:
let instanceToComponentCache: { [instanceId: string]: string } = {};
let componentPropertiesCache: { [componentId: string]: ComponentPropertyInfo } = {};
```

2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `resetComponentCache()`:

```typescript
export function resetComponentCache(): void {
  instanceToComponentCache = {};
  componentPropertiesCache = {};
  cacheHits = 0;
  cacheMisses = 0;
  totalLookups = 0;
  Logger.debug('üßπ [PropCache] –ö—ç—à —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ—á–∏—â–µ–Ω');
}
```

## –ó–∞–¥–∞—á–∞ 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫—ç—à–∞

### –ê–Ω–∞–ª–∏–∑:
–°–µ–π—á–∞—Å `instanceToComponentCache` –¥–µ–ª–∞–µ—Ç –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ `instanceId ‚Üí instanceId`:

```typescript
instanceToComponentCache[instanceId] = instanceId;
componentPropertiesCache[instanceId] = info;
```

### –†–µ—à–µ–Ω–∏–µ:
–£–¥–∞–ª–∏—Ç—å `instanceToComponentCache`, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `componentPropertiesCache` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `propertyCache`).

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

1. –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É 33 (`instanceToComponentCache`)
2. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `componentPropertiesCache` ‚Üí `propertyCache`
3. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:
   - `getOrBuildPropertyCache()` ‚Äî —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `instanceToComponentCache`
   - `resetComponentCache()` ‚Äî —É–±—Ä–∞—Ç—å –æ—á–∏—Å—Ç–∫—É `instanceToComponentCache`
   - `logComponentCacheStats()` ‚Äî —É–±—Ä–∞—Ç—å `cachedInstances`

### –ù–æ–≤—ã–π –∫–æ–¥ `getOrBuildPropertyCache()`:

```typescript
export function getOrBuildPropertyCache(instance: InstanceNode): ComponentPropertyInfo | null {
  const instanceId = instance.id;
  
  // –ë—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
  if (instanceId in propertyCache) {
    cacheHits++;
    return propertyCache[instanceId];
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–≤–æ–π—Å—Ç–≤
  if (!instance.componentProperties || Object.keys(instance.componentProperties).length === 0) {
    return null;
  }
  
  // –°—Ç—Ä–æ–∏–º –∫—ç—à
  cacheMisses++;
  const info = buildPropertyInfo(instance);
  propertyCache[instanceId] = info;
  
  return info;
}
```

## –ó–∞–¥–∞—á–∞ 3: JSDoc –∏ @deprecated

### –§–∞–π–ª: `src/property-utils.ts`

### –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫ –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º (—Å—Ç—Ä–æ–∫–∏ 131-140):

```typescript
/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
 * –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏–º—ë–Ω —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –ø—Ä–æ–±—É–µ—Ç –Ω–∞–π—Ç–∏ –ø–µ—Ä–≤–æ–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ.
 * 
 * ‚ö° –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô API ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à –¥–ª—è O(1) lookup.
 * 
 * @param instance –ò–Ω—Å—Ç–∞–Ω—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * @param propertyNames –ú–∞—Å—Å–∏–≤ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∏–º—ë–Ω —Å–≤–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ['View', 'view', 'VIEW'])
 * @param value –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
 * @param fieldName –ò–º—è –ø–æ–ª—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
 * @returns true –µ—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–æ –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, false –µ—Å–ª–∏ —Å–≤–æ–π—Å—Ç–≤–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
 * 
 * @example
 * // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ View —Å fallback –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
 * trySetProperty(instance, ['View', 'view', 'VIEW'], 'large', '#View');
 * 
 * // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ boolean
 * trySetProperty(instance, ['Discount', 'discount'], true, '#Discount');
 */
export function trySetProperty(...) { ... }
```

### –î–æ–±–∞–≤–∏—Ç—å @deprecated –∫ —Å—Ç–∞—Ä—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º:

```typescript
/**
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {@link trySetProperty} –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
 * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã setProperties —Å try/catch.
 * 
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ boolean-—Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
 * –ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ CSV/JSON –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —á–µ—Ä–µ–∑ setProperties.
 */
export function processBooleanProperty(...) { ... }

/**
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {@link trySetProperty} –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
 * 
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–Ω–µ boolean, –Ω–µ variant property —Å options).
 */
export function processStringProperty(...) { ... }

/**
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {@link trySetVariantProperty} –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
 * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è (275 —Å—Ç—Ä–æ–∫) –∏ –¥–µ–ª–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã API.
 * 
 * –û–±—Ä–∞–±–æ—Ç–∫–∞ Variant Properties —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å PropertyName=value (–±–µ–∑ –º–∞—Ä–∫–µ—Ä–∞ @).
 */
export function processVariantProperty(...) { ... }
```

## –ó–∞–¥–∞—á–∞ 4: –£–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### –§–∞–π–ª: `src/handlers/price-handlers.ts` (—Å—Ç—Ä–æ–∫–∞ 11)

```typescript
// –ë—ã–ª–æ:
import { processVariantProperty, processStringProperty, trySetVariantProperty, trySetProperty } from '../property-utils';

// –°—Ç–∞–ª–æ (–µ—Å–ª–∏ processVariantProperty –∏ processStringProperty –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è):
import { trySetVariantProperty, trySetProperty } from '../property-utils';
```

### –§–∞–π–ª: `src/handlers/delivery-handlers.ts` (—Å—Ç—Ä–æ–∫–∞ 9)

```typescript
// –ë—ã–ª–æ:
import { processVariantProperty, trySetProperty } from '../property-utils';

// –°—Ç–∞–ª–æ:
import { trySetProperty } from '../property-utils';
```

### –§–∞–π–ª: `src/handlers/snippet-handlers.ts` (—Å—Ç—Ä–æ–∫–∞ 11)

```typescript
// –ë—ã–ª–æ:
import { processVariantProperty, trySetProperty } from '../property-utils';

// –°—Ç–∞–ª–æ:
import { trySetProperty } from '../property-utils';
```

**–í–ê–ñ–ù–û**: –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –∏–º–ø–æ—Ä—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ!

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] `component-cache.ts`: –ò–∑–º–µ–Ω–∏—Ç—å `const` ‚Üí `let` –¥–ª—è –∫—ç—à–µ–π
- [ ] `component-cache.ts`: –£–ø—Ä–æ—Å—Ç–∏—Ç—å `resetComponentCache()` –¥–æ –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è
- [ ] `component-cache.ts`: –£–¥–∞–ª–∏—Ç—å `instanceToComponentCache`, —É–ø—Ä–æ—Å—Ç–∏—Ç—å `getOrBuildPropertyCache()`
- [ ] `component-cache.ts`: –û–±–Ω–æ–≤–∏—Ç—å `logComponentCacheStats()`
- [ ] `property-utils.ts`: –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫ `trySetProperty`
- [ ] `property-utils.ts`: –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫ `trySetVariantProperty`
- [ ] `property-utils.ts`: –î–æ–±–∞–≤–∏—Ç—å `@deprecated` –∫ `processBooleanProperty`
- [ ] `property-utils.ts`: –î–æ–±–∞–≤–∏—Ç—å `@deprecated` –∫ `processStringProperty`
- [ ] `property-utils.ts`: –î–æ–±–∞–≤–∏—Ç—å `@deprecated` –∫ `processVariantProperty`
- [ ] `handlers/*.ts`: –£–±—Ä–∞—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run build` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run lint` ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å warnings

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
2. –ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ (—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –Ω–µ—Ç)
3. –ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–µ–µ
4. ESLint –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç warnings –ø–æ unused imports

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ `Refactor_Stage2_Split_Functions` ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ `processVariantProperty` –Ω–∞ —á–∞—Å—Ç–∏.

