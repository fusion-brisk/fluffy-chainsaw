# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ EProductSnippet

Figma-–ø–ª–∞–≥–∏–Ω **EProductSnippet** –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫–µ—Ç–æ–≤ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ HTML/MHTML —Ñ–∞–π–ª–æ–≤ –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
1. **UI (ui.tsx)** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç HTML —Ñ–∞–π–ª
2. **–ü–∞—Ä—Å–µ—Ä (snippet-parser.ts)** ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ DOM –≤ `CSVRow[]`
3. **–ü–ª–∞–≥–∏–Ω (code.ts)** ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `EProductSnippet` –≤ Figma, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ –ø–æ–∑–∏—Ü–∏–∏ (Y‚ÜíX)
4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (component-handlers.ts)** ‚Üí –ø—Ä–∏–º–µ–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º Figma

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `src/code.ts` | –õ–æ–≥–∏–∫–∞ –ø–ª–∞–≥–∏–Ω–∞, –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| `src/component-handlers.ts` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Brand, EPriceGroup, Fintech, Delivery –∏ –¥—Ä.) |
| `src/utils/snippet-parser.ts` | –ü–∞—Ä—Å–∏–Ω–≥ HTML ‚Üí CSVRow, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–µ–π |
| `src/parsing-rules.ts` | –ü—Ä–∞–≤–∏–ª–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Å–µ–ª–µ–∫—Ç–æ—Ä—ã, —Ç–∏–ø—ã –ø–æ–ª–µ–π) |
| `src/property-utils.ts` | –£—Ç–∏–ª–∏—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ (Variant/String/Boolean) |
| `config/parsing-rules.json` | JSON-–∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∞–≤–∏–ª –ø–∞—Ä—Å–∏–Ω–≥–∞ |

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ
- `#OrganicTitle` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `#OrganicPrice` ‚Äî —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
- `#OldPrice` ‚Äî —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ (–ø–µ—Ä–µ—á—ë—Ä–∫–Ω—É—Ç–∞—è)
- `#DiscountPercent` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä "‚àí65%")
- `#ShopName` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
- `#OrganicHost` ‚Äî –¥–æ–º–µ–Ω –º–∞–≥–∞–∑–∏–Ω–∞
- `#OrganicImage` ‚Äî URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
- `#FaviconImage` ‚Äî URL —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
- `#ProductRating` ‚Äî —Ä–µ–π—Ç–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "4.7")
- `#ShopRating` ‚Äî —Ä–µ–π—Ç–∏–Ω–≥ –º–∞–≥–∞–∑–∏–Ω–∞
- `#ReviewsNumber` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–µ (Boolean/Variant Properties)

#### EPriceGroup
- `#EPriceGroup_Discount` ‚Üí Variant Property `Discount=true/false`
- `#EPriceGroup_OldPrice` ‚Üí Variant Property `Old Price=true/false`
- `#EPriceGroup_Fintech` ‚Üí Variant Property `Fintech=true/false`

#### Fintech (–≤–Ω—É—Ç—Ä–∏ EPriceGroup)
- `#Fintech_Type` ‚Üí Variant Property `type=Split` –∏–ª–∏ `type=Pay`
- `#Fintech_View` ‚Üí Variant Property `view=extra short` –∏–ª–∏ `view=short`

#### EPrice
- `#EPrice_View` ‚Üí String/Variant Property `view=special` (–∫—Ä–∞—Å–Ω–∞—è —Ü–µ–Ω–∞)

#### LabelDiscount
- `#LabelDiscount_View` ‚Üí Variant Property `view=outlineSpecial`
- `#DiscountPrefix` ‚Üí —Ç–µ–∫—Å—Ç "–í–∞–º" –ø–µ—Ä–µ–¥ —Å–∫–∏–¥–∫–æ–π

#### –î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `#EMarketCheckoutLabel` ‚Üí `visible=true/false` (–ª–µ–π–±–ª "–ü–æ–∫—É–ø–∫–∏")
- `#OfficialShop` ‚Üí `visible=true/false` –¥–ª—è –≥—Ä—É–ø–ø—ã "After" –≤ EShopName
- `#EDeliveryGroup` ‚Üí `visible=true/false` –¥–ª—è –±–ª–æ–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
- `#EDeliveryGroup-Item-1`, `#EDeliveryGroup-Item-2`, ... ‚Üí —Ç–µ–∫—Å—Ç—ã –ø—É–Ω–∫—Ç–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- `#EDeliveryGroup-Count` ‚Üí –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—É–Ω–∫—Ç–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ

### –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ HTML

–°–Ω–∞—á–∞–ª–∞ –∏–∑—É—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É HTML —Å –ø–æ–º–æ—â—å—é Python:

```python
from bs4 import BeautifulSoup

with open('–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.html', 'r', encoding='utf-8') as f:
    html = f.read()

soup = BeautifulSoup(html, 'html.parser')

# –ù–∞–π–¥–∏ –Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
elements = soup.select('[class*="–ù—É–∂–Ω—ã–π–ö–ª–∞—Å—Å"]')
for el in elements:
    classes = el.get('class', [])
    text = el.get_text(strip=True)[:50]
    print(f'Classes: {classes}')
    print(f'Text: {text}')
    print()
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ (snippet-parser.ts)

–í —Ñ—É–Ω–∫—Ü–∏–∏ `extractRowData()` –¥–æ–±–∞–≤—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

```typescript
// –î–ª—è boolean-–ø–æ–ª—è (–Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞)
const myElement = queryFirstMatch(cache, ['.MySelector', '[class*="MySelector"]']);
if (myElement) {
  row['#MyField'] = 'true';
  console.log(`‚úÖ –ù–∞–π–¥–µ–Ω MyElement –≤ —Å–Ω–∏–ø–ø–µ—Ç–µ "${row['#OrganicTitle']?.substring(0, 30)}..."`);
} else {
  row['#MyField'] = 'false';
}

// –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
const myTextElement = queryFirstMatch(cache, ['.MyTextSelector']);
if (myTextElement) {
  row['#MyTextField'] = myTextElement.textContent?.trim() || '';
}

// –î–ª—è Variant Property –∏–∑ –∫–ª–∞—Å—Å–æ–≤
const myVariant = queryFirstMatch(cache, ['.MyComponent']);
if (myVariant) {
  const classes = myVariant.className || '';
  if (classes.includes('MyComponent_type_optionA')) {
    row['#MyComponent_Type'] = 'optionA';
  } else if (classes.includes('MyComponent_type_optionB')) {
    row['#MyComponent_Type'] = 'optionB';
  }
}
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í `src/parsing-rules.ts` –∏–ª–∏ `config/parsing-rules.json`:

```typescript
// –í parsing-rules.ts
'MyField': {
    domSelectors: ['.MySelector', '[class*="MySelector"]'],
    jsonKeys: [],
    type: 'boolean' // –∏–ª–∏ 'text', 'price', 'image', 'attribute'
}
```

```json
// –í config/parsing-rules.json
"MyField": {
  "domSelectors": [".MySelector", "[class*=\"MySelector\"]"],
  "jsonKeys": [],
  "type": "boolean"
}
```

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (component-handlers.ts)

```typescript
// –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ visibility toggle
export function handleMyComponent(context: HandlerContext): void {
  const { container, row } = context;
  if (!container || !row) return;

  const hasMyField = row['#MyField'] === 'true';
  const myInstance = findInstanceByName(container, 'MyComponentName');
  
  if (myInstance) {
    try {
      myInstance.visible = hasMyField;
      Logger.debug(`   üîß [MyComponent] visible=${hasMyField}`);
    } catch (e) {
      Logger.error(`   ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ visible –¥–ª—è MyComponent:`, e);
    }
  }
}

// –î–ª—è Variant Property
export function handleMyVariantComponent(context: HandlerContext): void {
  const { container, row } = context;
  if (!container || !row) return;

  const myValue = row['#MyField_Type'];
  if (!myValue) return;
  
  const myInstance = findInstanceByName(container, 'MyComponentName');
  if (myInstance) {
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∫–∞–∫ Variant Property
    const success = processVariantProperty(myInstance, `type=${myValue}`, '#MyField_Type');
    if (!success) {
      // Fallback –Ω–∞ String Property
      processStringProperty(myInstance, 'type', myValue, '#MyField_Type');
    }
    Logger.debug(`   üîß [MyComponent] type=${myValue}`);
  }
}

// –î–ª—è Boolean Property
export function handleMyBooleanComponent(context: HandlerContext): void {
  const { container, row } = context;
  if (!container || !row) return;

  const myValue = row['#MyField'] === 'true';
  const myInstance = findInstanceByName(container, 'MyComponentName');
  
  if (myInstance) {
    processVariantProperty(myInstance, `MyProperty=${myValue}`, '#MyField');
  }
}
```

### –®–∞–≥ 5: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ code.ts

–í —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `import-csv`, –≤ —Ü–∏–∫–ª–µ `for (const [containerKey, data] of containersToProcess)`:

```typescript
try {
  handleBrandLogic(context);
  handleEPriceGroup(context);
  handleEPriceBarometer(context);
  handleEMarketCheckoutLabel(context);
  handleOfficialShop(context);
  handleEPriceView(context);
  handleLabelDiscountView(context);
  handleMyComponent(context);  // <-- –î–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞
  // ...
}
```

## –í–∞–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### ES5 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
–ò—Ç–æ–≥–æ–≤—ã–π `dist/code.js` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ES5. –ò—Å–ø–æ–ª—å–∑—É–π:
- `function` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–µ–ª–æ—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- `var` –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Ö–æ—Ç—è let/const —Ç—Ä–∞–Ω—Å–ø–∏–ª–∏—Ä—É—é—Ç—Å—è)

### –¢–∏–ø—ã —Å–≤–æ–π—Å—Ç–≤ Figma

1. **Variant Property** ‚Äî —Å–≤–æ–π—Å—Ç–≤–æ —Å –æ–ø—Ü–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `type: Split | Pay`)
   ```typescript
   processVariantProperty(instance, 'type=Split', '#Fintech_Type');
   ```

2. **Boolean Property** ‚Äî `true`/`false`
   ```typescript
   processBooleanProperty(instance, 'Brand', 'true', '#Brand');
   ```

3. **String Property** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
   ```typescript
   processStringProperty(instance, 'view', 'special', '#EPrice_View');
   ```

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `EProductSnippet` –≤ Figma —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏:
1. –°–Ω–∞—á–∞–ª–∞ –ø–æ Y (—Å—Ç—Ä–æ–∫–∏)
2. –ó–∞—Ç–µ–º –ø–æ X (–∫–æ–ª–æ–Ω–∫–∏)

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Figma –ø–æ—Ä—è–¥–∫—É —Å–Ω–∏–ø–ø–µ—Ç–æ–≤ –≤ HTML (DOM order).

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π `Logger` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```typescript
Logger.info('–í–∞–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
Logger.debug('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è');
Logger.warn('–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ');
Logger.error('–û—à–∏–±–∫–∞:', e);
```

### –ü–æ–∏—Å–∫ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

```typescript
// –ù–∞–π—Ç–∏ –∏–Ω—Å—Ç–∞–Ω—Å –ø–æ –∏–º–µ–Ω–∏
const instance = findInstanceByName(container, 'ComponentName');

// –ù–∞–π—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π
const textNode = findTextLayerByName(container, '#FieldName');

// –ù–∞–π—Ç–∏ –≥—Ä—É–ø–ø—É/—Ñ—Ä–µ–π–º
const group = findGroupByName(container, 'GroupName');

// –ù–∞–π—Ç–∏ –≤—Å–µ —É–∑–ª—ã —Å –∏–º–µ–Ω–µ–º
const nodes = findAllNodesByName(container, '#ItemName');
```

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

### –ü—Ä–∏–º–µ—Ä: EMarketCheckoutLabel (visibility toggle)
```typescript
export function handleEMarketCheckoutLabel(context: HandlerContext): void {
  const { container, row } = context;
  if (!container || !row) return;

  const hasLabel = row['#EMarketCheckoutLabel'] === 'true';
  const labelInstance = findInstanceByName(container, 'EMarketCheckoutLabel');
  
  if (labelInstance) {
    try {
      labelInstance.visible = hasLabel;
      Logger.debug(`   üè∑Ô∏è [EMarketCheckoutLabel] visible=${hasLabel}`);
    } catch (e) {
      Logger.error(`   ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ visible –¥–ª—è EMarketCheckoutLabel:`, e);
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä: Fintech (Variant Property)
```typescript
// –í handleEPriceGroup():
if (hasFintech) {
  const fintechInstance = findInstanceByName(ePriceGroupInstance, 'Fintech');
  if (fintechInstance) {
    const fintechType = row['#Fintech_Type'];
    if (fintechType) {
      const typeSet = processVariantProperty(fintechInstance, `type=${fintechType}`, '#Fintech_Type');
      if (!typeSet) {
        processStringProperty(fintechInstance, 'type', fintechType, '#Fintech_Type');
      }
    }
  }
}
```

### –ü—Ä–∏–º–µ—Ä: EDeliveryGroup (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ items)
```typescript
export async function handleEDeliveryGroup(context: HandlerContext): Promise<void> {
  const { container, row } = context;
  if (!container || !row) return;

  const hasDelivery = row['#EDeliveryGroup'] === 'true';
  const deliveryGroupInstance = findInstanceByName(container, 'EDeliveryGroup');
  
  if (!deliveryGroupInstance) return;
  
  if (!hasDelivery) {
    deliveryGroupInstance.visible = false;
    return;
  }
  
  deliveryGroupInstance.visible = true;
  
  const itemLayers = findAllNodesByName(deliveryGroupInstance, '#EDeliveryGroup-Item');
  const itemCount = parseInt(row['#EDeliveryGroup-Count'] || '0', 10);
  
  for (let i = 0; i < itemLayers.length; i++) {
    const layer = itemLayers[i];
    const dataIndex = i + 1;
    const itemValue = row[`#EDeliveryGroup-Item-${dataIndex}`];
    
    if (itemValue && dataIndex <= itemCount) {
      if (layer.type === 'TEXT') {
        const textNode = layer as TextNode;
        await figma.loadFontAsync(textNode.fontName as FontName);
        textNode.characters = itemValue;
        textNode.visible = true;
      }
    } else {
      layer.visible = false;
    }
  }
}
```

## –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞
npm run build

# –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ dist/
# - dist/code.js ‚Äî –ª–æ–≥–∏–∫–∞ –ø–ª–∞–≥–∏–Ω–∞
# - dist/ui.html ‚Äî UI –ø–ª–∞–≥–∏–Ω–∞
```

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –ø–ª–∞–≥–∏–Ω –≤ Figma (–∑–∞–∫—Ä—ã—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–Ω–æ–≤–æ).

