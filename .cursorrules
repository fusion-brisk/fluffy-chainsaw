# Глобальная цель
Мы пишем Figma-плагин "Contentify": инструменты автозаполнения макетов данными.

# Хард-ограничения
- Совместимость с Figma Plugin API и её окружением (ES5 в code.js).
- Никаких Node.js API в рантайме плагина (code.js); только браузерное и Figma API.
- UI собирается отдельно, общение через postMessage (figma.ui.postMessage ↔ onmessage).
- Весь итоговый код должен быть без синтаксических ошибок, в одном файле при изменениях интерфейса (ui.html) — отдаём целиком.
- Логирование шагов обязательно: UI-лог панель + события в консоли.
- Поддержка смены Variant Properties у инстансов, обработка nested instances, кэширование изображений, правильный переход по строкам данных.
- Строгая ES5-цель на выходе (babel → preset-env до IE11), без полифиллов.

# Сборка
- TypeScript только для типов. Транспиляция и бандлинг — через Rollup + Babel до ES5.
- code.ts → dist/code.js (IIFE)
- ui.tsx → dist/ui.js + dist/ui.html

# Стиль кода
- ESLint + Prettier + EditorConfig. Форматирование на сохранение.

# Коммуникация с ИИ (Cursor)
- Всегда соблюдать ES5 для code.js.
- Не добавлять сторонние рантайм-зависимости, требующие нативных модулей.
- При запросе изменений в ui.html — отдавать полный файл, а не дифф.
- Обновления маленьких файлов (utils.ts и т.п.) — можно диффом, но без поломанной сборки.
- При генерации кода — учитывать существующие файлы и импорты, не дублировать сущности.

# Структура
- src/code.ts — логика плагина
- src/ui.tsx — логика окна
- src/ui.html — каркас UI
- src/styles.css — стили UI, нативный стиль Figma
- rollup.config.mjs / babel.config.cjs / tsconfig.json — конфиги
- dist/ — результат сборки, на него смотрит manifest.json

# Логи и надёжность
- Подробные логи этапов: поиск контейнеров, применение данных, варианты, изображение/ошибки.
- На ошибках изображений — красная подсветка + лог содержимого ячейки URL.
- Перебор слоёв строго в порядке столбцов таблицы; одна строка на один инстанс.

# Ответы Cursor
- Держать ответы краткими и практичными. Для крупных блоков — предлагать отдельный полный файл.